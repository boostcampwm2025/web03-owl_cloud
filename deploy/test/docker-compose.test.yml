# 거의 똑같은데 https부분만 삭제
services:

  # main_backend  
  main-backend:
    container_name: main-backend
    image: "${MAIN_BACKEND_IMG}:latest"
    env_file:
      - ./main_backend/.env.backend
    networks:
      - clobby-network
    restart: unless-stopped
    ports:
      - "40000-40199:40000-40199/udp"
      - "40000-40199:40000-40199/tcp"

  # main_backend에 nginx 
  main-backend-nginx:
    container_name: main-backend-nginx
    image: nginx:latest
    volumes:
      - ./main_backend/nginx.backend.conf:/etc/nginx/nginx.conf:ro
    depends_on:
      - main-backend
    networks:
      - clobby-network
    restart: unless-stopped

  # tool_backend 서버
  tool-backend-app-1:
    container_name: tool-backend-app-1
    image: "${TOOL_BACKEND_IMG}:latest"
    env_file:
      - ./tool_backend/.env.backend
    networks:
      - clobby-network 
    restart: unless-stopped

  tool-backend-app-2:
    container_name: tool-backend-app-2
    image: "${TOOL_BACKEND_IMG}:latest"
    env_file:
      - ./tool_backend/.env.backend
    networks:
      - clobby-network
    restart: unless-stopped

  tool-backend-app-3:
    container_name: tool-backend-app-3
    image: "${TOOL_BACKEND_IMG}:latest"
    env_file:
      - ./tool_backend/.env.backend
    networks:
      - clobby-network
    restart: unless-stopped

  # tool_backend nginx
  tool-backend-nginx:
    container_name: tool-backend-nginx
    image: nginx:latest
    volumes:
      - ./tool_backend/nginx.backend.conf:/etc/nginx/nginx.conf:ro
    depends_on:
      - tool-backend-app-1
      - tool-backend-app-2
      - tool-backend-app-3
    networks:
      - clobby-network
    restart: unless-stopped

  # frontend 
  frontend:
    container_name: frontend
    image: "${FRONTEND_IMG}:latest"
    networks:
      - clobby-network
    restart: unless-stopped 

  # frontend-nginx
  frontend-nginx:
    container_name: frontend-nginx
    image: nginx:latest
    volumes:
      - ./frontend/nginx.frontend.conf:/etc/nginx/nginx.conf:ro
    depends_on:
      - frontend
    networks:
      - clobby-network
    restart: unless-stopped

  # gateway
  gateway:
    image: nginx:latest
    container_name: gateway
    ports:
      - "80:80"
    volumes:
      - ./nginx.test-gateway.conf:/etc/nginx/conf.d/default.conf:ro
    depends_on:
      - main-backend-nginx
      - tool-backend-nginx
      - frontend-nginx
    networks:
      - clobby-network
    restart: unless-stopped 

networks:
  clobby-network:
    driver: bridge